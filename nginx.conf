events {}

http {
    # Upstreams for each microservice
    upstream users_backend {
        server 127.0.0.1:5001;
        # server 127.0.0.1:6001;  # second instance if you run it
    }

    upstream rooms_backend {
        server 127.0.0.1:5002;
        # server 127.0.0.1:6002;
    }

    upstream bookings_backend {
        server 127.0.0.1:5003;
        # server 127.0.0.1:6003;
    }

    upstream reviews_backend {
        server 127.0.0.1:5004;
        # server 127.0.0.1:6004;
    }

    server {
        listen 8080;

        # Users service
        location /users/ {
            proxy_pass http://users_backend;
        }

        # Rooms service
        location /rooms/ {
            proxy_pass http://rooms_backend;
        }

        # Bookings service
        location /bookings/ {
            proxy_pass http://bookings_backend;
        }

        # Reviews service
        location /reviews/ {
            proxy_pass http://reviews_backend;
        }
    }
}
